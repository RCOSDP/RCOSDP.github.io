# 承認API

-   目的・用途

本機能はアクティビティを承認するAPIである。

-   利用方法

APIを実行する。

-   利用可能なロール

| ロール             | システム管理者 | リポジトリ管理者 | サブリポジトリ管理者 | 登録ユーザー | 一般ユーザー | ゲスト(未ログイン) |
|:------------------:|:-------------:|:---------------:|:-------------------:|:-----------:|:-----------:|:----------------:|
| 利用可否           | ○             | ○               | ○                  | ○           | ×           | ×                |

-   機能内容

-   指定したアクティビティをログイン中のユーザーで承認する。

-   関連モジュール

-   weko_workflow.views.py

-   処理概要

-   OAuth2認証機能を用いてユーザーの適切なアクセス制限を行う。

-   サーバー負荷軽減のためリクエストのアクセス制限機能をかける。

-   アクティビティ情報を取得する(get_activity_display_info)。

    -   取得できない場合は404エラー。

    -   アクティビティのステータスが承認でない場合は400エラー。

-   承認可能かどうかをチェックする(check_authority_action)。

    -   不可の場合はユーザー権限なしとして403エラー。

-   承認を行う(next_action)。

-   レスポンスに必要な情報を取得する。

    -   承認した情報を取得する(workflow_action_historyから最新の情報を取得)。

    -   フローから次のアクションを取得する。

-   リクエスト

    -   API仕様書を参照

-   レスポンス

    -   API仕様書を参照

-   更新履歴

| 日付      | 更新内容 |
|----------|----------|
|2023/7/4  |初版作成   |

# 却下API

-   目的・用途

本機能はアクティビティを却下するAPIである。

-   利用方法

APIを実行する。

-   利用可能なロール

| ロール             | システム管理者 | リポジトリ管理者 | コミュニティ管理者 | 登録ユーザー | 一般ユーザー | ゲスト(未ログイン) |
|:------------------:|:-------------:|:---------------:|:------------------:|:-----------:|:-----------:|:----------------:|
| 利用可否           | ○             | ○               | ○                  | ○           | ○           | ×                |

-   機能内容


-   指定したアクティビティをログイン中のユーザーで却下する。


-   関連モジュール


-   weko_workflow.views.py


-   処理概要


-   OAuth2認証機能を用いてユーザーの適切なアクセス制限を行う。

-   サーバー負荷軽減のためリクエストのアクセス制限機能をかける。

-   アクティビティ情報を取得する(get_activity_display_info)。

    -   取得できない場合は404エラー。

    -   アクティビティのステータスが承認でない場合は400エラー。

-   却下可能かどうかをチェックする(check_authority_action)。

    -   不可の場合はユーザー権限なしとして403エラー。

-   却下を行う(previous_action)。

-   レスポンスに必要な情報を取得する。

    -   却下した情報を取得する(workflow_action_historyから最新の情報を取得)。

    -   フローから次のアクションを取得する。

-   リクエスト

    -   API仕様書を参照

-   レスポンス

    -   API仕様書を参照


-   更新履歴

| 日付      | 更新内容 |
|----------|----------|
|2023/7/4  |初版作成   |
