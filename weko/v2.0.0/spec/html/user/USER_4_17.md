### Item Registration：リクエストメール機能

- 目的・用途

リクエストメールの送信有無をアイテム単位で設定する。

- 利用方法

【Administration > 設定（Settings） >アイテム表示（Items）画面】で、リクエストメールを送信する設定になっていること。  
リクエストメールの送信が有効の場合、Item Registration画面に「リクエストボタンを表示」チェックボックスが表示される。

- 利用可能なロール

<table>
<thead>
<tr class="header">
<th>ロール</th>
<th>システム<br />
管理者</th>
<th>リポジトリ<br />
管理者</th>
<th>コミュニティ<br />
管理者</th>
<th>登録ユーザー</th>
<th>一般ユーザー</th>
<th>ゲスト<br />
(未ログイン)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>利用可否</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>○</td>
<td>※</td>
<td></td>
</tr>
</tbody>
</table>

※一般ユーザーは、ロールとして利用可能に設定することはできないが、個別のユーザーをAction Userとして設定することはできる。

- 機能内容

  - Item Registration画面にて、「リクエストボタンを表示」チェックボックスにチェックを付けることで、リクエスト送信先を設定する。

  - アイテム登録画面の一番下の「リクエスト送信先」領域にリクエストメール送信先を設定できる

    - ［著者DBから入力（From author DB）］ボタン

      - ボタンを押下すると、著者DBの検索ウィンドウが表示される

      - 「検索」ボタンを押すと、【Admin > Setting > Author Management > Author ID 】登録された著者DB一覧を表示する

      - メールが設定されていない著者がいた場合でも著者を表示するが、Importボタンを非活性にする

        - メールアドレスがリストボックスに表示されていない著者を選択すると、リストボックス上にメールアドレスがインポートされる

        - メールアドレスがリストボックスに表示された著者を選択すると、以下のエラーメッセージを表示し、リストボックス上にインポートされない  
          エラーメッセージ：「Duplicate Email Addresses.」

    - リストボックス

      - 送信対象者となる著者のメールアドレスが表示される

      - メールアドレスはクリックすると選択できる

      - メールアドレスを選択している状態で、[Delete]ボタンを押下すると、選択した著者のメールアドレスがリストボックスから消える(送信対象者から外れる)

      - リストボックスはテキスト入力できる  
        テキスト入力されたデータの"先頭"と"末尾"にスペースがあった場合はトリム処理をした上で設定する

      - 次のアクションに進むタイミングで、リストボックス内のメールアドレスのバリデート処理(メールアドレスとして満たしているか)を行う。

      - バリデート処理で問題があった場合、エラーを表示して次のアクションには進めない。

        - 入力されたメールアドレスの形式が不正の場合、以下のエラーメッセージを表示する  
          エラーメッセージ：「Invalid email format.」

        - 入力されたメールアドレスが重複している場合、以下のエラーメッセージを表示する  
          エラーメッセージ：「Duplicate Email Addresses.」

  - 「リクエストボタンを表示」チェックボックスにチェックを付いている状態で、リクエストメール送信先が未入力の場合、エラーメッセージを表示して次のアクションには進めない。

    - メールアドレスが未入力の場合、以下のエラーメッセージを表示する。  
      エラーメッセージ: 「Request Email Addresses do not exist.」

  - リクエストメール送信先は、承認者が承認をした時点から有効となる。

    - このとき、リクエストフォームの表示設定が無効化されている(display_request_mail_form=false)の場合、登録されたアイテムにリクエスト送信先を設定しない。


- 関連モジュール

  - weko_items_ui

- 処理概要

  実装モジュール：weko-admin
  設定情報を保存する

  - アイテム登録時、 フィードバックメール送信先を入力する場合、「Approval」ステップに承認した後、フィードバックメール送信先の情報を以下のように保存される

  - 【Administration > 設定（Settings） > アイテム表示（Items）】に入力した情報をデータベースに以下のように保存する

    - テーブル名：admin_settings
    - 保存先レコード： name = “items_display_settings”のレコード
    - 項目名: display_request_mail_form
    - 既定値: true

- 更新履歴

<table>
<thead>
<tr class="header">
<th>日付</th>
<th>GitHubコミットID</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><blockquote>
<p>2025/10/10</p>
</blockquote></td>
<td></td>
<td>初版作成</td>
</tr>
</tbody>
</table>